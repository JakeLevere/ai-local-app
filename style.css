/* Combined Stylesheet: Hierarchy Visuals & Panel Fix */

:root {
    --sidebar-bg: #1f1f23;
    --color-accent: #8ab4f8;
    --color-accent-hover: #9ac0f9;
    --sidebar-item-hover: rgba(138, 180, 248, 0.1);
    --sidebar-item-selected: rgba(138, 180, 248, 0.2);
    --sidebar-item-selected-border: var(--color-accent);
    --button-text-dark: #111;
    --separator-color: #3a3a3d;
    --scroll-padding: 10px;
    --bg-very-dark: #1a1a1d;
    --bg-dark-grey: #18181b;
    --text-off-white: #efeff1;
    --text-grey: #adadb8;
    --text-dark-grey: #888;
    --border-color: #444;
    --input-bg: #3a3a3d;
    --user-green: #7FFFD4;
    --light-cyan: #e0ffff;

    /* Spacing Scale (4px increments) */
    --space-0: 0;
    --space-1: 0.25rem; /* 4px */
    --space-2: 0.5rem;  /* 8px */
    --space-3: 0.75rem; /* 12px */
    --space-4: 1rem;    /* 16px */
    --space-5: 1.25rem; /* 20px */
    --space-6: 1.5rem;  /* 24px */
    --space-7: 1.75rem; /* 28px */
    --space-8: 2rem;    /* 32px */
    --space-9: 2.25rem; /* 36px */
    --space-10: 2.5rem; /* 40px */

    /* Font Size Scale */
    --font-size-xs: 0.75rem;   /* 12px */
    --font-size-sm: 0.875rem;  /* 14px */
    --font-size-md: 1rem;      /* 16px */
    --font-size-lg: 1.25rem;   /* 20px */
    --font-size-xl: 1.5rem;    /* 24px */
    --font-size-2xl: 2rem;     /* 32px */

    /* Component Variables */
    --primary-icon-size: var(--space-10);
    --primary-item-padding: var(--space-2) var(--space-3);
    --primary-font-size: var(--font-size-md);
    --display-highlight: rgba(255, 165, 0, 0.6);
    --title-bar-height: 30px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg-very-dark); color: var(--text-off-white); min-height: 100vh; overflow: hidden; }

#title-bar {
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
    width: 100%;
    height: var(--title-bar-height);
    background-color: var(--bg-dark-grey);
    border-bottom: 1px solid var(--border-color);
    -webkit-app-region: drag;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 var(--space-3);
}


#window-controls {
    display: flex;
    gap: var(--space-2);
}

.window-button {
    width: 16px;
    height: 16px;
    border: none;
    background: transparent;
    color: var(--text-off-white);
    cursor: pointer;
    -webkit-app-region: no-drag;
    line-height: 16px;
    text-align: center;
    padding: 0;
    border-radius: 3px;
}

.window-button:hover {
    background-color: var(--border-color);
}
.app-container {
    display: grid;
    grid-template-columns: minmax(50px, 260px) 1fr minmax(50px, 340px);
    grid-template-rows: 1fr;
    height: calc(100vh - var(--title-bar-height)); /* Proper compression */
    margin-top: var(--title-bar-height);           /* Don't let it clip under fixed bar */
    min-height: 0;
    background-color: var(--bg-dark-grey);
    gap: 1px;
    background-color: var(--border-color);
    transition: grid-template-columns 0.3s ease-in-out;
}

#main-content, #central-display, #displays-container {
    min-height: 0;
    min-width: 0;
}
.app-container.collapsed { grid-template-columns: 50px 1fr minmax(50px, 340px); }
.app-container.chat-collapsed { grid-template-columns: minmax(50px, 260px) 1fr 50px; }
.app-container.collapsed.chat-collapsed { grid-template-columns: 50px 1fr 50px; }

/* --- Left Sidebar --- */
#left-sidebar {
    background-color: var(--sidebar-bg);
    width: 260px;
    padding: 0;
    transition: width 0.3s ease-in-out, transform 0.6s ease;
    position: relative;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    overflow-y: auto;
    transform-origin: left center;
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
    min-height: 0;
    height: 100%;
}
#left-sidebar.collapsed { width: 50px; padding: 0; }
#left-sidebar.collapsed #app-title { display: none; }
#persona-section { padding: 10px 10px 0 10px; display: flex; flex-direction: column; padding-bottom: 10px; border-bottom: 1px solid var(--separator-color); }

#left-sidebar h2 { font-size: var(--font-size-xs); font-weight: 600; color: var(--text-grey); text-transform: uppercase; letter-spacing: 0.8px; padding: var(--space-2) 0 var(--space-1) var(--space-1); margin: var(--space-2) 0 var(--space-1) 0; border: none; flex-shrink: 0; }
#create-deck, #create-slide { width: 100%; padding: var(--space-2) var(--space-3); margin-bottom: var(--space-2); background-color: var(--button-primary-bg); color: var(--button-text-dark); border: none; border-radius: var(--space-1); cursor: pointer; font-size: var(--font-size-sm); font-weight: 600; text-align: center; transition: background-color 0.2s ease, opacity 0.2s ease; flex-shrink: 0; }
#create-deck:hover, #create-slide:hover { background-color: var(--button-primary-hover-bg); opacity: 0.9; }
#deck-controls { margin-bottom: var(--space-2); padding: var(--space-1) 0; flex-shrink: 0; }
#deck-dropdown { width: 100%; padding: 6px 8px; background-color: var(--input-bg); color: var(--text-off-white); border: 1px solid var(--border-color); border-radius: 5px; font-size: 0.85em; -webkit-appearance: none; appearance: none; }

/* --- Persona List Hierarchy Styles --- */
.persona-list-container { list-style: none; padding: 0; margin: 0; flex-grow: 1; min-height: 0; }
#persona-list-container { display: block; }
.loading-personas { padding: 15px; text-align: center; color: var(--text-grey); font-style: italic; }

.persona-item { display: flex; align-items: center; margin-bottom: var(--space-1); cursor: pointer; border-radius: var(--space-1); transition: background-color 0.15s ease, border-left-color 0.15s ease; overflow: hidden; border-left: 3px solid transparent; }
.favorite-star { margin-left: auto; color: var(--text-grey); font-size: 1.1rem; cursor: pointer; }
.favorite-star.active { color: gold; }
.persona-item:hover { background-color: var(--sidebar-item-hover); }
.persona-name { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.4; }

/* Primary Persona Item Styling */
.persona-item.primary-persona {
    padding: var(--primary-item-padding);
}
.persona-item.primary-persona .persona-icon {
    width: var(--primary-icon-size);
    height: var(--primary-icon-size);
    margin-right: var(--space-3);
}
.persona-item.primary-persona .persona-name {
    font-weight: 600;
    font-size: var(--primary-font-size);
}
.persona-item.primary-persona.selected { background-color: var(--sidebar-item-selected); border-left-color: var(--sidebar-item-selected-border); }



/* Deck List */
.deck-list { list-style: none; padding: 0; margin: 0; flex-grow: 1; min-height: 0; }
#deck-list { display: none; }
.deck-item { display: flex; align-items: center; padding: var(--space-2) var(--space-2); margin-bottom: var(--space-1); cursor: pointer; border-radius: var(--space-1); transition: background-color 0.15s ease; overflow: hidden; border-left: 3px solid transparent; }
.deck-item:hover { background-color: var(--sidebar-item-hover); }
.deck-item.selected { background-color: var(--sidebar-item-selected); border-left: 3px solid var(--sidebar-item-selected-border); }
.slide-icon { width: var(--space-8); height: var(--space-8); border-radius: var(--space-1); object-fit: cover; margin-right: var(--space-3); border: 1px solid var(--border-color); flex-shrink: 0; background-color: #444; }
.slide-name { flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: var(--font-size-sm); color: var(--text-off-white); line-height: 1.4; }
button.deck-save-btn { margin-left: var(--space-1); background: none; border: none; color: var(--text-off-white); cursor: pointer; }

/* Sidebar Collapse Arrow */
#collapse-arrow { position: absolute; top: 8px; right: 8px; width: 24px; height: 24px; padding: 2px; cursor: pointer; fill: var(--text-grey); transition: transform 0.3s ease-in-out, right 0.3s ease-in-out, fill 0.2s ease; border-radius: 4px; }
#collapse-arrow:hover { background-color: var(--sidebar-item-hover); fill: var(--text-off-white); }

#app-title {
    margin: 10px;
    padding: 6px 8px;
    color: var(--light-cyan);
    font-size: 1.2em;
    font-weight: bold;
    text-shadow: 0 0 10px var(--light-cyan);
    border: 2px solid var(--light-cyan);
    border-radius: 6px;
}

/* Collapsed State Styling (Sidebar) */
#left-sidebar.collapsed { width: 50px; padding: 0; }
#left-sidebar.collapsed #app-title { display: none; }
#left-sidebar.collapsed .persona-name,
#left-sidebar.collapsed h2,
#left-sidebar.collapsed #deck-controls,
#left-sidebar.collapsed #create-slide,
#left-sidebar.collapsed .slide-name,
#left-sidebar.collapsed #create-deck { display: none; }
#left-sidebar.collapsed #persona-section { padding: 5px; align-items: center; overflow-y: hidden; padding-bottom: 5px; border-bottom: 1px solid var(--separator-color); margin-bottom: 5px; }
#left-sidebar.collapsed .persona-item,
#left-sidebar.collapsed .deck-item { padding: 6px 0px; margin-bottom: 4px; margin-right: 0; justify-content: center; border-left: none; width: 100%; }
#left-sidebar.collapsed .persona-item.primary-persona.selected { background-color: var(--sidebar-item-selected); }
#left-sidebar.collapsed .persona-icon,
#left-sidebar.collapsed .slide-icon { margin-right: 0; width: 30px; height: 30px; }
#left-sidebar.collapsed #collapse-arrow { transform: rotate(180deg); right: auto; left: 13px; top: 6px; }

/* --- Main Content Area --- */
#main-content { background-color: var(--bg-very-dark); padding: 0; position: relative; overflow: auto; display: flex; flex-direction: column; height: 100%; min-height: 0; }
#central-display { width: 100%; display: flex; flex-direction: column; flex-grow: 1; overflow: auto; min-height: 0; }

#persona-status-bar {
    width: 100%;
    background-color: var(--sidebar-bg);
    border-bottom: 1px solid var(--border-color);
    position: relative;
    z-index: 10;
    transition: height 0.3s ease-in-out, padding 0.3s ease-in-out, transform 0.6s ease;
    height: 100px;
    padding: 10px;
    overflow: visible;
    flex-shrink: 0;
    transform-origin: top center;
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
}

#persona-status-bar.collapsed {
    height: 60px; /* MODIFIED: Set fixed height for collapsed state */
    padding: 0;
    overflow: visible; /* Needed to show collapse arrow, which is positioned outside */
}

#status-header {
    position: static;
    display: block;
    height: 0;
    overflow: visible;
}

#persona-image {
    position: absolute;
    top: 10px;
    left: 10px;
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid rgba(138, 180, 248, 0.6);
    background-color: #333;
    box-shadow: 0 0 10px rgba(0,0,0,0.7);
    margin-right: 0;
    flex-shrink: 0;
    z-index: 11;
    transition: all 0.3s ease-in-out;
}

#persona-status-bar.collapsed #persona-image {
    top: 10px;
    left: 10px;
    width: 40px;
    height: 40px;
    z-index: 15;
}

#status-text-content {
    position: absolute;
    top: 15px;
    left: 105px;
    right: 40px;
    display: flex;
    flex-direction: row; 
    align-items: baseline; 
    gap: 20px; 
    overflow: hidden;
    flex-grow: 1;
    opacity: 1;
    transition: opacity 0.2s ease-in-out 0.1s;
}

#persona-status-bar.collapsed #status-text-content {
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.1s ease-in-out;
}

#status-title { font-size: 1.2em; font-weight: bold; color: var(--text-off-white); white-space: nowrap; }
#status-info { font-size: 0.9em; color: var(--text-grey); margin-top: 0; white-space: nowrap; }
#status-info span { margin-right: 15px; }

/* Status collapse arrow removed - panel stays collapsed */
#status-collapse-arrow {
    display: none !important;
}

#displays-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px;
    position: relative;
    z-index: 5;
    transition: padding-top 0.3s ease-in-out;
    scroll-padding-top: var(--scroll-padding, 10px);
    scroll-padding-bottom: var(--scroll-padding, 10px);
}

#persona-status-bar.collapsed + #displays-container {
    padding-top: 70px; /* MODIFIED: Make space for the 60px collapsed bar */
}

.display-wrapper { width: 100%; position: relative; aspect-ratio: 16 / 9; margin-bottom: 10px; }
.display { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #222; border: 1px solid var(--border-color); border-radius: 4px; overflow: hidden; display: flex; filter: brightness(35%); transition: filter 0.3s ease-in-out; }
.display img, .display webview, .display iframe { border: none; display: none; width: 100%; height: 100%; min-height: 100%; flex-shrink: 0; object-fit: contain; background-color: #000; }
.display img.active, .display webview.active, .display iframe.active { display: block; }
.display .loading { position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; border: 4px solid var(--text-grey); border-top: 4px solid var(--color-accent); border-radius: 50%; animation: spin 1s linear infinite; transform: translate(-50%, -50%); display: none; z-index: 5; }
.display.loading-active .loading { display: block; }
@keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
.bounce-in { animation: bounce-in 0.6s ease forwards; }
@keyframes bounce-in { 0% { transform: scale(0.8); opacity: 0; } 60% { transform: scale(1.05); opacity: 1; } 100% { transform: scale(1); } }

/* Vault door opening animations */
#left-sidebar.vault-open { animation: vault-left 0.6s ease; }
#right-chat.vault-open { animation: vault-right 0.6s ease; }
#persona-status-bar.vault-open { animation: vault-top 0.6s ease; }
#info-panels.vault-open { animation: vault-bottom 0.6s ease; }
#program-maker.vault-open { animation: vault-bottom 0.6s ease; }

@keyframes vault-left {
  0% { transform: rotateY(0deg); }
  50% { transform: rotateY(-75deg); }
  100% { transform: rotateY(0deg); }
}
@keyframes vault-right {
  0% { transform: rotateY(0deg); }
  50% { transform: rotateY(75deg); }
  100% { transform: rotateY(0deg); }
}
@keyframes vault-top {
  0% { transform: rotateX(0deg); }
  50% { transform: rotateX(75deg); }
  100% { transform: rotateX(0deg); }
}
@keyframes vault-bottom {
  0% { transform: rotateX(0deg); }
  50% { transform: rotateX(-75deg); }
  100% { transform: rotateX(0deg); }
}

/* Temporary orange glow on edges during vault open */
#left-sidebar.center-glow::after,
#right-chat.center-glow::after,
#persona-status-bar.center-glow::after,
#info-panels.center-glow::after,
#program-maker.center-glow::after {
  content: '';
  position: absolute;
  background: var(--display-highlight);
  box-shadow: 0 0 12px 4px var(--display-highlight);
  pointer-events: none;
  z-index: 50;
  opacity: 1;
  animation: glow-fade 0.8s forwards;
}

#left-sidebar.center-glow::after { top: 0; right: 0; width: 2px; height: 100%; }
#right-chat.center-glow::after { top: 0; left: 0; width: 2px; height: 100%; }
#persona-status-bar.center-glow::after { bottom: 0; left: 0; width: 100%; height: 2px; }
#info-panels.center-glow::after { top: 0; left: 0; width: 100%; height: 2px; }
#program-maker.center-glow::after { top: 0; left: 0; width: 100%; height: 2px; }

@keyframes glow-fade {
  from { opacity: 1; }
  to { opacity: 0; }
}
.display-number { position: absolute; top: 5px; left: 5px; background-color: rgba(0, 0, 0, 0.7); color: var(--text-off-white); padding: 2px 5px; border-radius: 3px; font-size: 0.8em; z-index: 10; }
.clear-button { position: absolute; top: 5px; right: 5px; width: 20px; height: 20px; background-color: rgba(255, 0, 0, 0.6); color: white; text-align: center; line-height: 20px; border-radius: 50%; cursor: pointer; font-size: 0.8em; font-weight: bold; z-index: 10; border: 1px solid rgba(255, 255, 255, 0.3); transition: background-color 0.2s ease; }
.clear-button:hover { background-color: rgba(200, 0, 0, 0.8); }
.program-icons {
    position: absolute;
    bottom: 5px;
    left: 5px;
    display: flex;
    gap: 4px;
    z-index: 10;
}
.program-icon {
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: rgba(0,0,0,0.6);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
}
.program-icon:hover {
    background-color: var(--sidebar-item-hover);
}

/* Enlarged and centered when the display has no content */
.display.empty .program-icons {
    top: 50%;
    left: 50%;
    bottom: auto;
    transform: translate(-50%, -50%);
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}
.display.empty .program-icon {
    width: 60px;
    height: 60px;
    font-size: 28px;
}
.scroll-spacer { height: 60vh; width: 100%; flex-shrink: 0; }

/* --- Slide Tabs --- */
#slide-tabs {
    position: absolute;
    top: 50px;
    left: 105px;
    right: 40px;
    height: 45px;
    display: flex;
    align-items: center;
    gap: 2px;
    overflow-x: auto;
    overflow-y: hidden;
    padding-left: 48px;
    transition: top 0.3s ease-in-out, left 0.3s ease-in-out, height 0.3s ease-in-out;
}


/* Deck icon container and icons */
#deck-container {
    position: absolute;
    left: 105px;
    /* MODIFIED: Vertically aligned with the slide tabs for better visual grouping. */
    top: 50px;
    transition: top 0.3s ease-in-out, left 0.3s ease-in-out;
    z-index: 13;
}
#persona-status-bar.collapsed #deck-container {
    left: 60px;
    top: 10px; /* Align deck icon with collapsed persona image */
}

.deck-icon {
    width: 40px;
    height: 40px;
    flex: 0 0 auto;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    color: #fff;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    user-select: none;
    direction: ltr;
}
#deck-main {
    background-color: #e74c3c;
}

#deck-icons {
    display: none;
    position: absolute;
    top: 45px;
    left: 0;
    flex-direction: column;
    gap: 4px;
    max-height: 220px; /* approx. 220px to show several deck icons */
    direction: rtl;        /* move scrollbar left */
    overflow-y: auto;
}

#deck-container.expanded #deck-icons {
    display: flex;
}

.deck-icon.add-deck {
    font-size: 24px;
    line-height: 1;
}

/* Wrapper for deck icons to position the hover save button */
.deck-icon-wrapper {
    position: relative;
}

/* Save button that appears when hovering over the deck icon */
.deck-save-hover {
    position: absolute;
    top: 0;
    left: 100%;
    width: 20px;
    height: 20px;
    padding: 0;
    margin-left: 2px;
    border: none;
    background: none;
    display: none;
    cursor: pointer;
}

.deck-save-hover img {
    width: 100%;
    height: 100%;
}

.deck-icon-wrapper:hover .deck-save-hover {
    display: block;
}

/* UPDATED: Correctly position tabs within the collapsed panel */
#persona-status-bar.collapsed #slide-tabs {
    top: 10px; /* Position vertically with the collapsed persona image */
    left: 60px; /* Position horizontally next to the persona image */
    height: 40px; /* Match height of the collapsed image */
}

.slide-tab {
    display: flex;
    align-items: center;
    padding: 2px 4px;
    cursor: pointer;
    border: 1px solid var(--border-color);
    border-bottom: none;
    border-radius: 4px 4px 0 0;
    background-color: var(--bg-dark-grey);
    transition: background-color 0.15s ease;
    flex-shrink: 0;
}

#slide-tabs .slide-icon {
    width: 24px;
    height: 24px;
    margin-right: 0;
}

#slide-tabs .slide-name {
    display: none;
}

.slide-tab:hover { background-color: var(--sidebar-item-hover); }
.slide-tab.selected { background-color: var(--sidebar-item-selected); border-color: var(--sidebar-item-selected-border); }

/* --- Right Chat Panel --- */
#right-chat {
    background-color: var(--bg-dark-grey);
    padding: 0;
    height: 100%;
    min-height: 0;
    border-left: 1px solid var(--border-color);
    transition: width 0.3s ease-in-out, transform 0.6s ease;
    width: 340px;
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transform-origin: right center;
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
}

/* --- Persona Video Overlay --- */
#persona-video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    z-index: 20;
    background-color: var(--sidebar-bg);
    border-bottom: 2px solid var(--border-color);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.8);
    transition: transform 0.3s ease-in-out;
    height: 50%;
    display: flex;
    flex-direction: column;
}

#persona-video-overlay.minimized {
    transform: translateY(-100%);
    margin-top: 35px; /* Keep header visible */
}

#persona-video-header {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    background-color: rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid var(--border-color);
    gap: 10px;
    height: 35px;
    flex-shrink: 0;
}

#persona-video-header #persona-select {
    flex-grow: 1;
    padding: 4px 8px;
    background-color: var(--input-bg);
    color: var(--text-off-white);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 0.9em;
}

#persona-video-header #favorite-star-overlay {
    font-size: 1.2rem;
    cursor: pointer;
    color: var(--text-grey);
    transition: color 0.2s ease;
}

#persona-video-header #favorite-star-overlay.active {
    color: gold;
}

#video-minimize-arrow {
    width: 20px;
    height: 20px;
    cursor: pointer;
    fill: var(--text-off-white);
    transition: transform 0.3s ease-in-out;
}

#persona-video-overlay.minimized #video-minimize-arrow {
    transform: rotate(180deg);
}

#persona-video-container {
    flex-grow: 1;
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #000;
}

#persona-video-container #persona-preview-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

#persona-video-container #persona-preview-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none;
    position: absolute;
    top: 0;
    left: 0;
}
#right-chat.collapsed { width: 50px; padding: 0; }
#right-chat.collapsed #chat-log-container h2, #right-chat.collapsed #chat-log-container #chat-log, #right-chat.collapsed #chat-input-area { display: none; }
#right-chat.collapsed #chat-collapse-arrow { transform: rotate(180deg); right: auto; left: 15px; }
#chat-log-container { 
    flex-grow: 1; 
    display: flex; 
    flex-direction: column; 
    overflow: hidden; 
    padding: 10px 15px 0 15px; 
    position: relative;
    margin-top: 50%; /* Make space for video overlay */
    transition: margin-top 0.3s ease-in-out;
}

#persona-video-overlay.minimized ~ #chat-log-container {
    margin-top: 35px; /* Only header height when minimized */
}
#chat-log-container h2 { margin-bottom: 10px; flex-shrink: 0; border: none; padding-left: 0; padding-bottom: 5px; border-bottom: 1px solid var(--border-color); font-size: 0.75em; font-weight: 600; color: var(--text-grey); text-transform: uppercase; letter-spacing: 0.8px; }
#chat-log { flex-grow: 1; overflow-y: auto; padding-right: 5px; margin-bottom: 10px; line-height: 1.5; font-size: 0.9em; color: #ccc; }
#chat-log p { margin-bottom: 10px; padding: 8px 12px; word-wrap: break-word; border-radius: 8px; max-width: 85%; }
#chat-log p.user-message { background-color: #ADD8E6; color: #000000; margin-left: auto; margin-right: 0; }
#chat-log p.ai-message { background-color: var(--sidebar-bg); color: var(--text-off-white); margin-right: auto; margin-left: 0; }
#chat-log p.status-message { background-color: transparent; color: var(--text-grey); font-style: italic; text-align: center; font-size: 0.8em; margin-left: auto; margin-right: auto; padding: 4px 0; max-width: 100%; }
#chat-log p strong { margin-right: 5px; font-weight: 600; position: relative; display: block; margin-bottom: 3px; font-size: 0.8em; opacity: 0.8; }
#chat-log p.user-message strong { display: none; }
#chat-log p.ai-message strong { color: var(--color-accent); }
#chat-log p.ai-message.error-message strong { color: #FF6B6B; }
#chat-log p.ai-message strong .thinking-bar { display: none; position: absolute; bottom: -2px; left: 0; width: 0; height: 2px; background-color: var(--color-accent); animation: thinking 1.5s linear infinite; }
#chat-log p.ai-message.thinking-active strong .thinking-bar { display: inline-block; }
@keyframes thinking { 0% { width: 0; opacity: 0.5; } 50% { width: 100%; opacity: 1; } 100% { width: 0; opacity: 0.5; } }
#chat-input-area { display: flex; padding: 15px; border-top: 1px solid var(--border-color); background-color: var(--sidebar-bg); flex-shrink: 0; }
#chat-input-area input[type="text"] { flex-grow: 1; padding: 8px 10px; border: 1px solid #555; background-color: var(--input-bg); color: var(--text-off-white); border-radius: 4px; margin-right: 10px; font-size: 0.9em; }
#chat-input-area input[type="text"]::placeholder { color: var(--text-dark-grey); }
#chat-input-area button { padding: 8px 15px; border: none; background-color: var(--color-accent); color: #111; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease; font-size: 0.9em; font-weight: 600; }
#chat-input-area button:hover { background-color: var(--color-accent-hover); }
#chat-collapse-arrow { position: absolute; top: 8px; right: 8px; width: 24px; height: 24px; padding: 2px; cursor: pointer; fill: var(--text-grey); transition: transform 0.3s ease-in-out, left 0.3s ease-in-out, fill 0.2s ease; border-radius: 4px; z-index: 10; }
#chat-collapse-arrow:hover { background-color: var(--sidebar-item-hover); fill: var(--text-off-white); }


/* --- Config Panel --- */
#info-panels {
    position: relative;
    margin-top: 10px;
    background-color: var(--bg-dark-grey);
    border-top: 1px solid var(--border-color);
    box-shadow: 0 0 10px rgba(0,0,0,0.8);
    transform-origin: bottom center;
    height: auto;
    min-height: 40px;
}
#config-header { background-color: var(--sidebar-bg); padding: 10px; cursor: default; font-size: 0.9em; color: var(--text-off-white); text-align: center; border-bottom: 1px solid var(--border-color); }
#config-content { display: none; }
.dropdown { margin-bottom: 10px; }
.dropdown-header { background-color: var(--bg-dark-grey); padding: 10px; cursor: pointer; border: 1px solid var(--border-color); border-radius: 4px; font-size: 0.9em; color: var(--text-off-white); transition: background-color 0.2s ease; }
.dropdown-header:hover { background-color: rgba(138, 180, 248, 0.1); }
.dropdown-content { max-height: 0; overflow: hidden; padding: 0 10px; background-color: var(--input-bg); border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 4px 4px; transition: max-height 0.3s ease-in-out, padding 0.1s ease-in-out; }
.dropdown-content.active { max-height: none; padding: 10px; overflow: visible; }
textarea { width: 100%; min-height: 100px; background-color: var(--bg-very-dark); color: var(--text-off-white); border: 1px solid #555; padding: 8px; font-size: 0.9em; resize: vertical; border-radius: 4px; overflow-y: hidden; }
.dropdown-buttons { margin-top: 10px; display: flex; justify-content: flex-end; }
.dropdown-buttons button { padding: 8px 15px; border: none; background-color: var(--color-accent); color: #111; border-radius: 4px; cursor: pointer; margin-left: 10px; font-size: 0.9em; font-weight: 600; transition: background-color 0.2s ease; }
.dropdown-buttons button:hover { background-color: var(--color-accent-hover); }
#info-panels.primary-selected #auto-pre-prompt, #info-panels.primary-selected #update-memory { display: none; }
#info-panels.primary-selected #memory-prompt-header, #info-panels.primary-selected #memory-prompt-content, #info-panels.primary-selected #memory-header, #info-panels.primary-selected #memory-content { display: none; }

/* --- Program Maker Section (in left sidebar) --- */
#program-maker-section {
    padding: 10px;
    border-top: 1px solid var(--separator-color);
    display: flex;
    flex-direction: column;
    gap: 10px;
}

#program-maker-section h2 {
    font-size: var(--font-size-xs);
    font-weight: 600;
    color: var(--text-grey);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin: 0;
}

#program-maker-section textarea {
    width: 100%;
    min-height: 80px;
    max-height: 150px;
    background-color: var(--bg-very-dark);
    color: var(--text-off-white);
    border: 1px solid var(--border-color);
    padding: 8px;
    border-radius: 4px;
    resize: vertical;
    font-size: 0.85em;
}

#program-maker-section button {
    padding: 8px 12px;
    background-color: var(--color-accent);
    color: var(--button-text-dark);
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.85em;
    font-weight: 600;
    transition: background-color 0.2s ease;
}

#program-maker-section button:hover {
    background-color: var(--color-accent-hover);
}

#program-output {
    background-color: var(--bg-very-dark);
    color: var(--text-off-white);
    border: 1px solid var(--border-color);
    border-radius: 4px;
    padding: 8px;
    max-height: 120px;
    overflow-y: auto;
    white-space: pre-wrap;
    font-size: 0.8em;
    font-family: monospace;
}

/* Hide program maker in collapsed sidebar */
#left-sidebar.collapsed #program-maker-section {
    display: none;
}


/* --- Global Scrollbar Styles --- */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: var(--sidebar-bg); border-radius: 4px; }
::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; border: 1px solid var(--sidebar-bg); }
::-webkit-scrollbar-thumb:hover { background: #666; }
#persona-section, #displays-container, #chat-log, #config-content, #deck-icons, .dropdown-content { scrollbar-width: thin; scrollbar-color: #444 var(--sidebar-bg); }

/* --- Login Overlay Styles --- */
#login-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    pointer-events: none;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
}
#login-overlay.active { pointer-events: all; }
#login-form {
    position: relative;
    background: linear-gradient(to bottom, var(--bg-dark-grey), #222);
    padding: var(--space-6);
    border-radius: var(--space-3);
    border: 2px solid var(--baby-blue);
    box-shadow: 0 0 20px var(--baby-blue);
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
    width: 300px;
}
#login-form h1 {
    margin: 0 0 var(--space-3);
    text-align: center;
    color: var(--baby-blue);
    font-size: var(--font-size-xl);
    text-shadow: 0 0 10px var(--baby-blue);

}
#login-form input {
    padding: var(--space-2);
    border-radius: var(--space-1);
    border: 1px solid var(--border-color);
    background: var(--input-bg);
    color: var(--text-off-white);
}
#login-form button {
    padding: var(--space-2) var(--space-4);
    border: none;
    background: var(--color-accent);
    color: #111;
    border-radius: var(--space-1);
    cursor: pointer;
    font-weight: 600;
    font-size: var(--font-size-sm);
    box-shadow: 0 0 10px var(--baby-blue);
}
#login-form button:hover { background: var(--color-accent-hover); }
#login-overlay.hidden { display: none; }

body.pre-login .app-container {
    grid-template-columns: 50vw 0 50vw;
}
body.pre-login #left-sidebar,
body.pre-login #right-chat,
body.pre-login #persona-status-bar,
body.pre-login #info-panels,
body.pre-login #program-maker {
    /* Disable transitions during the pre-login state to avoid the panels
       animating in from their default positions on initial load. */
    transition: none;
}
body.pre-login #left-sidebar,
body.pre-login #right-chat {
    width: 50vw;
    transform: none;
    z-index: 30;
}
body.pre-login #left-sidebar::before,
body.pre-login #right-chat::before {
    content: '';
    position: absolute;
    top: 0;
    width: 2px;
    height: 100%;
    background: var(--display-highlight);
    box-shadow: 0 0 12px 4px var(--display-highlight);
    pointer-events: none;
    z-index: 50;
}
body.pre-login #left-sidebar::before { right: 0; }
body.pre-login #right-chat::before { left: 0; }
body.logging-in #left-sidebar::before,
body.logging-in #right-chat::before { content: none; }
body.pre-login #persona-status-bar,
body.pre-login #info-panels,
body.pre-login #program-maker {
    height: 50vh;
    max-height: 50vh;
    transform: none;
    z-index: 20;
}
body.pre-login #left-sidebar > *,
body.pre-login #right-chat > *,
body.pre-login #persona-status-bar > *,
body.pre-login #info-panels > *,
body.pre-login #program-maker > *,
body.pre-login #displays-container {
    display: none;
}

body.logging-in #left-sidebar,
body.logging-in #right-chat,
body.logging-in #persona-status-bar,
body.logging-in #info-panels,
body.logging-in #program-maker {
    transform: none;
    width: auto;
    height: auto;
}
body.logging-in .app-container {
    grid-template-columns: minmax(50px, 260px) 1fr minmax(50px, 340px);
    transition: none;
}

body.logging-in #left-sidebar,
body.logging-in #right-chat,
body.logging-in #persona-status-bar,
body.logging-in #info-panels {
    transition: none;
}

/* Highlight displays that are fully visible */
.display.fully-visible {
    filter: brightness(100%);
    border-color: var(--border-color);
    box-shadow: none;
}

